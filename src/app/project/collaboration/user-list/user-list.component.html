<div *ngIf="list && !loading">

    <!-- header toolbar -->
    <div class="app-toolbar more-space-top" *ngIf="list.length > 0">
        <div class="app-toolbar-row">
            <h3 class="mat-body subtitle">{{title}}</h3>
        </div>
        <div class="app-toolbar-row">
            <h2 class="mat-title">{{list.length | i18nPlural: itemPluralMapping['member']}}</h2>
            <span class="fill-remaining-space"></span>
            <span class="app-toolbar-action">
                <kui-sort-button *ngIf="list.length > 1" [sortProps]="sortProps" [(sortKey)]="sortBy" [position]="'right'"></kui-sort-button>
            </span>
        </div>
    </div>

    <!-- list -->
    <table class="table">

        <tr *ngFor="let user of list; let last = last" [class.no-border]="last">
            <!-- avatar -->
            <td class="avatar-cell">
                <img kuiAdminImage [image]="user.email" [type]="'user'" class="avatar-image link" (click)="gotoUserProfile(user.username)" />
            </td>

            <!-- name and e-mail address -->
            <td>
                <h5 class="mat-subheading-2 link" (click)="gotoUserProfile(user.username)">
                    {{user.givenName}} {{user.familyName}}
                </h5>
                <p class="mat-subheading-1 link" (click)="gotoUserProfile(user.username)">
                    {{user.username}} | {{user.email}}
                    <!-- TODO: question: how public should the email address be? -->
                </p>
            </td>

            <!-- admin -->
            <td>
                <mat-chip-list>
                    <mat-chip *ngIf="isProjectAdmin(user.permissions)">Admin</mat-chip>
                </mat-chip-list>
            </td>

            <!-- group -->
            <td>
                <app-select-group [projectcode]="project.shortcode" [projectid]="project.id"
                                  [permissions]="user.permissions.groupsPerProject[project.id]" [disabled]="disabled"
                                  (groupChange)="updateGroupsMembership(user.id, $event)"></app-select-group>
            </td>
            <!-- action: menu with edit, remove, etc. -->
            <td class="table-action">
                <button mat-icon-button [matMenuTriggerFor]="projectUserMenu">
                    <mat-icon>more_horiz</mat-icon>
                </button>
                <mat-menu #projectUserMenu="matMenu" xPosition="before" class="menu">
                    <button mat-menu-item (click)="updateAdminMembership(user.id, user.permissions)">
                        <span *ngIf="!isProjectAdmin(user.permissions)">Add</span>
                        <span *ngIf="isProjectAdmin(user.permissions)">Remove</span>
                        <span>&nbsp;as project admin</span>
                    </button>
                    <button mat-menu-item (click)="openDialog('editUser', user.username)">
                        Edit user
                    </button>
                    <button mat-menu-item (click)="openDialog('editPassword', user.username)">
                        Change user's password
                    </button>
                    <button mat-menu-item (click)="removeUserFromProject(user.id)">
                        Remove user from project
                    </button>
                </mat-menu>
            </td>
        </tr>
    </table>

</div>
